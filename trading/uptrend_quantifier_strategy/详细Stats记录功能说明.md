# ğŸ“Š è¯¦ç»†StatsæŒ‡æ ‡è®°å½•åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å¢å¼ºçš„å‚æ•°ä¼˜åŒ–å™¨ç°åœ¨èƒ½å¤Ÿè®°å½•æ¯ä¸ªå‚æ•°ç»„åˆçš„**å®Œæ•´backtestingç»Ÿè®¡æŒ‡æ ‡**ï¼Œä¸ºæ‚¨æä¾›å…¨é¢çš„ç­–ç•¥æ€§èƒ½åˆ†ææ•°æ®ã€‚

## âœ¨ æ–°å¢åŠŸèƒ½ç‰¹æ€§

### 1. å®Œæ•´StatsæŒ‡æ ‡è®°å½•
- **21ä¸ªæ ¸å¿ƒç»Ÿè®¡æŒ‡æ ‡**ï¼šåŒ…å«æ”¶ç›Šç‡ã€é£é™©æŒ‡æ ‡ã€äº¤æ˜“ç»Ÿè®¡ç­‰
- **å‚æ•°ç»„åˆè¿½è¸ª**ï¼šæ¯æ¡è®°å½•éƒ½åŒ…å«å¯¹åº”çš„å‚æ•°è®¾ç½®
- **è‚¡ç¥¨çº§åˆ«æ•°æ®**ï¼šè®°å½•æ¯ä¸ªè‚¡ç¥¨åœ¨ä¸åŒå‚æ•°ä¸‹çš„è¡¨ç°

### 2. æ™ºèƒ½æ•°æ®å¤„ç†
- **ç±»å‹å®‰å…¨è½¬æ¢**ï¼šè‡ªåŠ¨å¤„ç†ä¸åŒæ•°æ®ç±»å‹ï¼ˆæ•°å€¼ã€æ—¶é—´é—´éš”ç­‰ï¼‰
- **å¼‚å¸¸å€¼å¤„ç†**ï¼šå¯¹æ— æ•ˆæˆ–ç¼ºå¤±æ•°æ®è¿›è¡Œåˆç†å¤„ç†
- **å†…å­˜ä¼˜åŒ–**ï¼šé«˜æ•ˆå­˜å‚¨å¤§é‡ç»Ÿè®¡æ•°æ®

### 3. å¤šç»´åº¦åˆ†æè¾“å‡º
- **è¯¦ç»†ç»“æœCSV**ï¼šåŒ…å«æ‰€æœ‰å‚æ•°ç»„åˆçš„å®Œæ•´stats
- **ç»Ÿè®¡æ‘˜è¦æŠ¥å‘Š**ï¼šè‡ªåŠ¨ç”Ÿæˆå…³é”®æŒ‡æ ‡çš„åˆ†å¸ƒåˆ†æ
- **æœ€ä½³å‚æ•°åˆ†æ**ï¼šè¯†åˆ«è¡¨ç°æœ€ä¼˜çš„å‚æ•°ç»„åˆ

## ğŸ“ˆ è®°å½•çš„StatisticsæŒ‡æ ‡

### æ”¶ç›Šç‡æŒ‡æ ‡
- `Return [%]` - æ€»æ”¶ç›Šç‡
- `Buy & Hold Return [%]` - ä¹°å…¥æŒæœ‰æ”¶ç›Šç‡
- `Return (Ann.) [%]` - å¹´åŒ–æ”¶ç›Šç‡

### é£é™©æŒ‡æ ‡
- `Volatility (Ann.) [%]` - å¹´åŒ–æ³¢åŠ¨ç‡
- `Max. Drawdown [%]` - æœ€å¤§å›æ’¤
- `Avg. Drawdown [%]` - å¹³å‡å›æ’¤
- `Max. Drawdown Duration` - æœ€å¤§å›æ’¤æŒç»­æ—¶é—´
- `Avg. Drawdown Duration` - å¹³å‡å›æ’¤æŒç»­æ—¶é—´

### é£é™©è°ƒæ•´æ”¶ç›ŠæŒ‡æ ‡
- `Sharpe Ratio` - å¤æ™®æ¯”ç‡
- `Sortino Ratio` - ç´¢æè¯ºæ¯”ç‡  
- `Calmar Ratio` - å¡å°”é©¬æ¯”ç‡
- `SQN` - ç³»ç»Ÿè´¨é‡æ•°

### äº¤æ˜“ç»Ÿè®¡æŒ‡æ ‡
- `# Trades` - äº¤æ˜“æ¬¡æ•°
- `Win Rate [%]` - èƒœç‡
- `Best Trade [%]` - æœ€ä½³äº¤æ˜“æ”¶ç›Š
- `Worst Trade [%]` - æœ€å·®äº¤æ˜“æŸå¤±
- `Avg. Trade [%]` - å¹³å‡æ¯ç¬”äº¤æ˜“æ”¶ç›Š
- `Profit Factor` - ç›ˆåˆ©å› å­
- `Expectancy [%]` - æœŸæœ›å€¼

### äº¤æ˜“æ—¶é—´æŒ‡æ ‡
- `Max. Trade Duration` - æœ€é•¿äº¤æ˜“æŒç»­æ—¶é—´
- `Avg. Trade Duration` - å¹³å‡äº¤æ˜“æŒç»­æ—¶é—´

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
results/
â””â”€â”€ detailed_stats_optimization/
    â””â”€â”€ UptrendQuantifierStrategy_advanced_opt_20250110_HHMMSS/
        â”œâ”€â”€ ğŸ“ˆ parameter_detailed_stats.csv      # ä¸»è¦æ–‡ä»¶ï¼šè¯¦ç»†Statsæ•°æ®
        â”œâ”€â”€ ğŸ“Š stats_summary_analysis.txt        # ç»Ÿè®¡åˆ†ææ‘˜è¦
        â”œâ”€â”€ ğŸ“„ detailed_results.csv             # ä¼˜åŒ–è¿‡ç¨‹æ±‡æ€»
        â”œâ”€â”€ ğŸ“„ best_parameters.txt              # æœ€ä½³å‚æ•°ç»„åˆ
        â””â”€â”€ âš¡ performance_stats.json           # æ€§èƒ½ç›‘æ§æ•°æ®
```

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### 1. parameter_detailed_stats.csv
**æœ€é‡è¦çš„è¾“å‡ºæ–‡ä»¶**ï¼ŒåŒ…å«ï¼š
- æ¯ä¸ªè‚¡ç¥¨åœ¨æ¯ä¸ªå‚æ•°ç»„åˆä¸‹çš„å®Œæ•´stats
- æ‰€æœ‰21ä¸ªç»Ÿè®¡æŒ‡æ ‡çš„æ•°å€¼
- å‚æ•°è®¾ç½®ä¿¡æ¯ï¼ˆlen_short, len_mid, len_long, adx_len, adx_thresholdï¼‰
- å‚æ•°å“ˆå¸Œå€¼ç”¨äºå»é‡å’Œåˆ†ç»„

**ç¤ºä¾‹æ•°æ®ç»“æ„ï¼š**
```csv
Stock,Return [%],Sharpe Ratio,Max. Drawdown [%],...,len_short,len_mid,len_long,adx_len,adx_threshold,param_hash
000001.SZ,15.23,1.45,-8.67,...,10,40,180,14,25,hash_value_1
000002.SZ,12.34,1.12,-12.45,...,10,40,180,14,25,hash_value_1
000001.SZ,18.76,1.67,-6.23,...,15,50,200,16,27,hash_value_2
...
```

### 2. stats_summary_analysis.txt
**ç»Ÿè®¡åˆ†ææ‘˜è¦**ï¼ŒåŒ…å«ï¼š
- æ•´ä½“æµ‹è¯•ç»Ÿè®¡ï¼ˆç»„åˆæ•°ã€è‚¡ç¥¨æ•°ç­‰ï¼‰
- å„å…³é”®æŒ‡æ ‡çš„åˆ†å¸ƒç»Ÿè®¡ï¼ˆå‡å€¼ã€ä¸­ä½æ•°ã€æ ‡å‡†å·®ç­‰ï¼‰
- æœ€ä½³å‚æ•°ç»„åˆçš„è¯¦ç»†è¡¨ç°åˆ†æ

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹
```python
# è¿è¡Œè¯¦ç»†statsè®°å½•çš„å‚æ•°ä¼˜åŒ–
python run_detailed_stats_optimization.py
```

### è‡ªå®šä¹‰ä½¿ç”¨
```python
from advanced_param_optimizer import AdvancedParameterOptimizer

# åˆ›å»ºä¼˜åŒ–å™¨
optimizer = AdvancedParameterOptimizer(
    strategy_class=UptrendQuantifierStrategy,
    data_dir='path/to/data',
    results_dir='path/to/results'
)

# è¿è¡Œä¼˜åŒ–ï¼ˆè‡ªåŠ¨è®°å½•è¯¦ç»†statsï¼‰
results = optimizer.optimize(param_ranges=param_ranges)

# è¯¦ç»†ç»“æœè‡ªåŠ¨ä¿å­˜åœ¨ optimizer.detailed_results ä¸­
print(f"è®°å½•äº† {len(optimizer.detailed_results)} æ¡è¯¦ç»†statsæ•°æ®")
```

## ğŸ“Š æ•°æ®åˆ†æç¤ºä¾‹

### 1. åŠ è½½è¯¦ç»†ç»“æœ
```python
import pandas as pd

# è¯»å–è¯¦ç»†statsæ•°æ®
df = pd.read_csv('parameter_detailed_stats.csv')
print(f"æ€»å…± {len(df)} æ¡è®°å½•")
print(f"æ¶‰åŠ {df['Stock'].nunique()} åªè‚¡ç¥¨")
print(f"æµ‹è¯•äº† {df['param_hash'].nunique()} ä¸ªå‚æ•°ç»„åˆ")
```

### 2. å‚æ•°æ€§èƒ½åˆ†æ
```python
# æŒ‰å‚æ•°ç»„åˆåˆ†ç»„ï¼Œè®¡ç®—å¹³å‡è¡¨ç°
param_cols = ['len_short', 'len_mid', 'len_long', 'adx_len', 'adx_threshold']
stats_cols = ['Sharpe Ratio', 'Return [%]', 'Max. Drawdown [%]']

param_performance = df.groupby(param_cols)[stats_cols].mean()
best_params = param_performance.sort_values('Sharpe Ratio', ascending=False).head(10)
print("æœ€ä½³å‚æ•°ç»„åˆ:")
print(best_params)
```

### 3. å•ä¸€æŒ‡æ ‡åˆ†å¸ƒåˆ†æ
```python
# åˆ†æå¤æ™®æ¯”ç‡åˆ†å¸ƒ
sharpe_stats = df['Sharpe Ratio'].describe()
print("å¤æ™®æ¯”ç‡åˆ†å¸ƒç»Ÿè®¡:")
print(sharpe_stats)

# ç»˜åˆ¶åˆ†å¸ƒå›¾
import matplotlib.pyplot as plt
df['Sharpe Ratio'].hist(bins=50)
plt.title('Sharpe Ratio Distribution')
plt.show()
```

### 4. å‚æ•°æ•æ„Ÿæ€§åˆ†æ
```python
# åˆ†æå„å‚æ•°å¯¹å¤æ™®æ¯”ç‡çš„å½±å“
for param in param_cols:
    param_impact = df.groupby(param)['Sharpe Ratio'].mean()
    print(f"\n{param} å¯¹å¤æ™®æ¯”ç‡çš„å½±å“:")
    print(param_impact.sort_values(ascending=False))
```

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. ç­–ç•¥å¼€å‘ä¼˜åŒ–
- **å‚æ•°è°ƒä¼˜**ï¼šåŸºäºå®Œæ•´statsé€‰æ‹©æœ€ä¼˜å‚æ•°
- **é£é™©æ§åˆ¶**ï¼šåˆ†æå›æ’¤å’Œæ³¢åŠ¨ç‡åˆ†å¸ƒ
- **ç¨³å¥æ€§æµ‹è¯•**ï¼šè¯„ä¼°ç­–ç•¥åœ¨ä¸åŒå¸‚åœºç¯å¢ƒä¸‹çš„è¡¨ç°

### 2. ç ”ç©¶åˆ†æ
- **å› å­æœ‰æ•ˆæ€§**ï¼šåˆ†æä¸åŒå‚æ•°å¯¹å„æŒ‡æ ‡çš„å½±å“
- **å¸‚åœºé€‚åº”æ€§**ï¼šç ”ç©¶ç­–ç•¥åœ¨ä¸åŒè‚¡ç¥¨ä¸Šçš„è¡¨ç°å·®å¼‚
- **æ—¶é—´ç¨³å®šæ€§**ï¼šè¯„ä¼°å‚æ•°è®¾ç½®çš„æ—¶é—´ç¨³å®šæ€§

### 3. é£é™©ç®¡ç†
- **å¤šç»´åº¦é£é™©è¯„ä¼°**ï¼šåŸºäº21ä¸ªæŒ‡æ ‡å…¨é¢è¯„ä¼°é£é™©
- **æç«¯æƒ…å†µåˆ†æ**ï¼šè¯†åˆ«æœ€å·®äº¤æ˜“å’Œæœ€å¤§å›æ’¤æƒ…å†µ
- **ç»„åˆä¼˜åŒ–**ï¼šåŸºäºè¯¦ç»†statsæ„å»ºæŠ•èµ„ç»„åˆ

## ğŸ’¡ æ€§èƒ½ç‰¹ç‚¹

### é«˜æ•ˆå¤„ç†
- **æ™ºèƒ½ç¼“å­˜**ï¼šé¿å…é‡å¤è®¡ç®—ï¼Œæå‡å¤„ç†é€Ÿåº¦
- **å¹¶è¡Œå¤„ç†**ï¼šå¤šè¿›ç¨‹å¹¶è¡Œå›æµ‹ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æº
- **å†…å­˜ä¼˜åŒ–**ï¼šé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒå¤§è§„æ¨¡å‚æ•°ä¼˜åŒ–

### æ•°æ®è´¨é‡
- **ç±»å‹å®‰å…¨**ï¼šè‡ªåŠ¨å¤„ç†ä¸åŒç±»å‹çš„ç»Ÿè®¡æ•°æ®
- **å¼‚å¸¸å¤„ç†**ï¼šå¯¹æ— æ•ˆæ•°æ®è¿›è¡Œåˆç†çš„é»˜è®¤å€¼å¤„ç†
- **å®Œæ•´æ€§æ£€æŸ¥**ï¼šç¡®ä¿æ¯ä¸ªå‚æ•°ç»„åˆçš„statså®Œæ•´è®°å½•

## ğŸ“‹ æ³¨æ„äº‹é¡¹

1. **å­˜å‚¨ç©ºé—´**ï¼šè¯¦ç»†statsä¼šäº§ç”Ÿè¾ƒå¤§çš„CSVæ–‡ä»¶ï¼Œè¯·ç¡®ä¿è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
2. **å†…å­˜ä½¿ç”¨**ï¼šå¤§é‡å‚æ•°ç»„åˆä¼šæ¶ˆè€—è¾ƒå¤šå†…å­˜ï¼Œå»ºè®®åˆç†è®¾ç½®å‚æ•°èŒƒå›´
3. **å¤„ç†æ—¶é—´**ï¼šè®°å½•è¯¦ç»†statsä¼šå¢åŠ ä¸€å®šçš„å¤„ç†æ—¶é—´ï¼Œä½†æ€§èƒ½å½±å“æœ‰é™
4. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿è¾“å…¥æ•°æ®çš„è´¨é‡ï¼Œé¿å…å¼‚å¸¸å€¼å½±å“ç»Ÿè®¡ç»“æœ

## ğŸ”§ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡
```python
def _extract_detailed_stats(self, stats) -> Dict:
    """å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡"""
    detailed_stats = super()._extract_detailed_stats(stats)
    
    # æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡
    detailed_stats['Custom_Metric'] = calculate_custom_metric(stats)
    
    return detailed_stats
```

### å®šåˆ¶åˆ†ææŠ¥å‘Š
```python
def _save_custom_analysis(self, detailed_df: pd.DataFrame):
    """è‡ªå®šä¹‰åˆ†ææŠ¥å‘Š"""
    # å®ç°æ‚¨çš„è‡ªå®šä¹‰åˆ†æé€»è¾‘
    pass
```

---

**é€šè¿‡è¿™ä¸ªå¢å¼ºåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è·å¾—æ¯ä¸ªå‚æ•°ç»„åˆçš„å®Œæ•´ç»Ÿè®¡ç”»åƒï¼Œä¸ºç­–ç•¥ä¼˜åŒ–å’Œé£é™©ç®¡ç†æä¾›å¼ºæœ‰åŠ›çš„æ•°æ®æ”¯æŒï¼** ğŸš€ 